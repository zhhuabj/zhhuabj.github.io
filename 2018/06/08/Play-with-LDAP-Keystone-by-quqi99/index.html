<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="版权声明：可以任意转载，转载时请务必以超链接形式标明文章原始出处和作者信息及本版权声明 (作者：张华 发表于：2018-05-29) Install OpenLDAPOpenLDAP Server可以使用这个charm安装 - https://jujucharms.com/u/openstack-charmers/ldap-test-fixture/3, 最终要添加的yaml如下：123456ke">
<meta property="og:type" content="article">
<meta property="og:title" content="Play with LDAP + Keystone (by quqi99)">
<meta property="og:url" content="http://yoursite.com/2018/06/08/Play-with-LDAP-Keystone-by-quqi99/index.html">
<meta property="og:site_name" content="技术并艺术着">
<meta property="og:description" content="版权声明：可以任意转载，转载时请务必以超链接形式标明文章原始出处和作者信息及本版权声明 (作者：张华 发表于：2018-05-29) Install OpenLDAPOpenLDAP Server可以使用这个charm安装 - https://jujucharms.com/u/openstack-charmers/ldap-test-fixture/3, 最终要添加的yaml如下：123456ke">
<meta property="og:updated_time" content="2018-07-10T08:27:09.223Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Play with LDAP + Keystone (by quqi99)">
<meta name="twitter:description" content="版权声明：可以任意转载，转载时请务必以超链接形式标明文章原始出处和作者信息及本版权声明 (作者：张华 发表于：2018-05-29) Install OpenLDAPOpenLDAP Server可以使用这个charm安装 - https://jujucharms.com/u/openstack-charmers/ldap-test-fixture/3, 最终要添加的yaml如下：123456ke">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/06/08/Play-with-LDAP-Keystone-by-quqi99/"/>





  <title>Play with LDAP + Keystone (by quqi99) | 技术并艺术着</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">技术并艺术着</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">张华的技术博客 - blog.csdn.net/quqi99</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/08/Play-with-LDAP-Keystone-by-quqi99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="张华">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="技术并艺术着">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Play with LDAP + Keystone (by quqi99)</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-08T18:09:28+08:00">
                2018-06-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong>版权声明：可以任意转载，转载时请务必以超链接形式标明文章原始出处和作者信息及本版权声明 (作者：张华 发表于：2018-05-29)</strong></p>
<h2 id="Install-OpenLDAP"><a href="#Install-OpenLDAP" class="headerlink" title="Install OpenLDAP"></a>Install OpenLDAP</h2><p>OpenLDAP Server可以使用这个charm安装 - <a href="https://jujucharms.com/u/openstack-charmers/ldap-test-fixture/3" target="_blank" rel="external">https://jujucharms.com/u/openstack-charmers/ldap-test-fixture/3</a>, 最终要添加的yaml如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">keystone-ldap:</span><br><span class="line">  charm: cs:keystone-ldap-10</span><br><span class="line">ldap-test-fixture:</span><br><span class="line">  charm: cs:~openstack-charmers/ldap-test-fixture</span><br><span class="line"></span><br><span class="line">- [ keystone-ldap, keystone ]</span><br></pre></td></tr></table></figure></p>
<p>也可以根据这个链接分步安装 - <a href="https://api.jujucharms.com/charmstore/v5/~openstack-charmers/ldap-test-fixture-3/archive/hooks/install" target="_blank" rel="external">https://api.jujucharms.com/charmstore/v5/~openstack-charmers/ldap-test-fixture-3/archive/hooks/install</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">export DEBIAN_FRONTEND=noninteractive</span><br><span class="line">echo -e &quot; \</span><br><span class="line">slapd slapd/internal/generated_adminpw password password</span><br><span class="line">slapd slapd/password2 password password</span><br><span class="line">slapd slapd/internal/adminpw password password</span><br><span class="line">slapd slapd/password1 password password</span><br><span class="line">&quot; | sudo debconf-set-selections</span><br><span class="line">sudo apt install slapd ldap-utils phpldapadmin</span><br><span class="line">sed -i &quot;s/dc=example/dc=test/g&quot; /etc/phpldapadmin/config.php</span><br><span class="line">service apache2 restart</span><br><span class="line">sudo service slapd restart</span><br><span class="line">#sudo dpkg-reconfigure slapd  #configure domain=test.com</span><br><span class="line">#slappasswd -h &#123;SSHA&#125; -s password</span><br><span class="line">#sudo apt-get install jxplorer  #GUI</span><br><span class="line"></span><br><span class="line"># How to test it</span><br><span class="line">sudo ldapsearch -h 10.5.0.72 -x -w password -D&quot;cn=admin,dc=test,dc=com&quot; -b dc=test,dc=com -s sub &apos;(objectclass=*)&apos; cn sn</span><br><span class="line">sudo ldapsearch -h 10.5.0.72 -x -w password -D&quot;cn=admin,dc=test,dc=com&quot; -b ou=users,dc=test,dc=com  &apos;(objectclass=*)&apos;  cn sn</span><br><span class="line">sudo ldapsearch -h 10.5.0.72 -x -w password -D&quot;cn=admin,dc=test,dc=com&quot; -b dc=test,dc=com</span><br></pre></td></tr></table></figure></p>
<h2 id="Modify-default-schema-to-support-OpenStack"><a href="#Modify-default-schema-to-support-OpenStack" class="headerlink" title="Modify default schema to support OpenStack"></a>Modify default schema to support OpenStack</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://api.jujucharms.com/charmstore/v5/~openstack-charmers/ldap-test-fixture-3/archive/files/backup.ldif</span><br><span class="line">slapadd -v -c -l .backup.ldif</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ldapsearch -h 10.5.0.72 -x -w password -D&quot;cn=admin,dc=test,dc=com&quot; -b dc=test,dc=com</span><br><span class="line"># extended LDIF</span><br><span class="line">#</span><br><span class="line"># LDAPv3</span><br><span class="line"># base &lt;dc=test,dc=com&gt; with scope subtree</span><br><span class="line"># filter: (objectclass=*)</span><br><span class="line"># requesting: ALL</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># test.com</span><br><span class="line">dn: dc=test,dc=com</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: dcObject</span><br><span class="line">objectClass: organization</span><br><span class="line">o: test</span><br><span class="line">dc: test</span><br><span class="line"></span><br><span class="line"># admin, test.com</span><br><span class="line">dn: cn=admin,dc=test,dc=com</span><br><span class="line">objectClass: simpleSecurityObject</span><br><span class="line">objectClass: organizationalRole</span><br><span class="line">cn: admin</span><br><span class="line">description: LDAP administrator</span><br><span class="line">userPassword:: e1NTSEF9Q1RxNU1nNHA5blhlL25WVjBqenZSYTZ2VkxQQnVJZjc=</span><br><span class="line"></span><br><span class="line"># groups, test.com</span><br><span class="line">dn: ou=groups,dc=test,dc=com</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">objectClass: top</span><br><span class="line">ou: groups</span><br><span class="line"></span><br><span class="line"># admin, groups, test.com</span><br><span class="line">dn: cn=admin,ou=groups,dc=test,dc=com</span><br><span class="line">cn: admin</span><br><span class="line">gidNumber: 500</span><br><span class="line">memberUid: johndoe</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">objectClass: top</span><br><span class="line"></span><br><span class="line"># openstack, groups, test.com</span><br><span class="line">dn: cn=openstack,ou=groups,dc=test,dc=com</span><br><span class="line">cn: openstack</span><br><span class="line">gidNumber: 501</span><br><span class="line">memberUid: johndoe</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">objectClass: top</span><br><span class="line"></span><br><span class="line"># users, test.com</span><br><span class="line">dn: ou=users,dc=test,dc=com</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">objectClass: top</span><br><span class="line">ou: users</span><br><span class="line"></span><br><span class="line"># janedoe, users, test.com</span><br><span class="line">dn: cn=janedoe,ou=users,dc=test,dc=com</span><br><span class="line">cn: janedoe</span><br><span class="line">gidNumber: 500</span><br><span class="line">givenName: Jane</span><br><span class="line">homeDirectory: /home/users/janedoe</span><br><span class="line">objectClass: inetOrgPerson</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: top</span><br><span class="line">sn: Jane Doe</span><br><span class="line">uid: janedoe</span><br><span class="line">uidNumber: 1001</span><br><span class="line">userPassword:: e01ENX1IT01SNHBNMTV0M2dZZDhXVXhNRzhnPT0=</span><br><span class="line"></span><br><span class="line"># johndoe, users, test.com</span><br><span class="line">dn: cn=johndoe,ou=users,dc=test,dc=com</span><br><span class="line">cn: johndoe</span><br><span class="line">gidNumber: 501</span><br><span class="line">givenName: John</span><br><span class="line">homeDirectory: /home/users/jdoe</span><br><span class="line">loginShell: /bin/sh</span><br><span class="line">objectClass: inetOrgPerson</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: top</span><br><span class="line">sn: John Doe</span><br><span class="line">uid: johndoe</span><br><span class="line">uidNumber: 1000</span><br><span class="line">userPassword:: e01ENX1IT01SNHBNMTV0M2dZZDhXVXhNRzhnPT0=</span><br><span class="line"></span><br><span class="line"># search result</span><br><span class="line">search: 2</span><br><span class="line">result: 0 Success</span><br><span class="line"></span><br><span class="line"># numResponses: 9</span><br><span class="line"># numEntries: 8</span><br></pre></td></tr></table></figure>
<h2 id="Configure-Keystone"><a href="#Configure-Keystone" class="headerlink" title="Configure Keystone"></a>Configure Keystone</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">juju config keystone preferred-api-version=3</span><br><span class="line">juju deploy keystone-ldap --series xenial</span><br><span class="line">juju add-relation keystone-ldap keystone</span><br><span class="line"></span><br><span class="line">juju config keystone-ldap ldap-server=&quot;ldap://10.5.0.72&quot; ldap-user=&quot;cn=admin,dc=test,dc=com&quot; ldap-password=&quot;crapper&quot; ldap-suffix=&quot;dc=test,dc=com&quot;</span><br><span class="line">juju config keystone-ldap domain-name=&quot;aaa_domain&quot;</span><br><span class="line">juju config keystone-ldap ldap-config-flags=&quot;&#123; user_tree_dn: &apos;dc=test,dc=com&apos;, query_scope: &apos;sub&apos;, user_objectclass: posixAccount, user_id_attribute: uid, user_name_attribute: uid, group_tree_dn: &apos;ou=groups,dc=test,dc=com&apos;, group_objectclass: posixGroup, group_id_attribute: gidNumber, group_name_attribute: cn, group_member_attribute: memberUid, group_members_are_ids: True&#125;&quot;</span><br><span class="line"></span><br><span class="line">root@juju-67d093-xenial-queens-ldap-2:~# cat /etc/keystone/domains/keystone.aaa_domain.conf</span><br><span class="line">[ldap]</span><br><span class="line">url = ldap://10.5.0.72</span><br><span class="line">user = cn=admin,dc=test,dc=com</span><br><span class="line">password = password</span><br><span class="line">suffix = dc=test,dc=com</span><br><span class="line"></span><br><span class="line">user_allow_create = False</span><br><span class="line">user_allow_update = False</span><br><span class="line">user_allow_delete = False</span><br><span class="line"></span><br><span class="line">group_allow_create = False</span><br><span class="line">group_allow_update = False</span><br><span class="line">group_allow_delete = False</span><br><span class="line"></span><br><span class="line"># User supplied configuration flags</span><br><span class="line">group_id_attribute = gidNumber</span><br><span class="line">group_member_attribute = memberUid</span><br><span class="line">group_members_are_ids = True</span><br><span class="line">group_name_attribute = cn</span><br><span class="line">group_objectclass = posixGroup</span><br><span class="line">group_tree_dn = ou=groups,dc=test,dc=com</span><br><span class="line">query_scope = sub</span><br><span class="line">#user_id_attribute = uidNumber</span><br><span class="line">user_id_attribute = uid</span><br><span class="line">user_name_attribute = uid</span><br><span class="line">user_objectclass = posixAccount</span><br><span class="line">user_tree_dn = dc=test,dc=com</span><br><span class="line">[identity]</span><br><span class="line">driver = ldap</span><br></pre></td></tr></table></figure>
<p>注意， 上面有几个重要参数，注意是group_members_are_ids = True，下面将要着重讲解。<br>query_scope = sub<br>user_tree_dn = dc=test,dc=com<br>user_id_attribute = uid<br>group_members_are_ids = True<br>下面配置也可以work:<br>query_scope = base<br>user_tree_dn = dc=users,test,dc=com<br>user_id_attribute = uid<br>group_members_are_ids = True</p>
<h2 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">source ~/stsstack-bundles/novarcv3_domain</span><br><span class="line">export OS_REGION_NAME=RegionOne</span><br><span class="line">export OS_USER_DOMAIN_NAME=admin_domain</span><br><span class="line">export OS_AUTH_VERSION=3</span><br><span class="line">export OS_IDENTITY_API_VERSION=3</span><br><span class="line">export OS_PASSWORD=openstack</span><br><span class="line">export OS_DOMAIN_NAME=admin_domain</span><br><span class="line">export OS_AUTH_URL=http://10.5.0.53:5000/v3</span><br><span class="line">export OS_USERNAME=admin</span><br><span class="line"></span><br><span class="line">openstack domain create --description &quot;aaa_domain&quot; aaa_domain</span><br><span class="line">openstack domain list</span><br><span class="line">openstack project create myproject --domain aaa_domain</span><br><span class="line">openstack project list --domain aaa_domain</span><br><span class="line">#The token used to make the request was project scoped but the policy requires [&apos;system&apos;] scope</span><br><span class="line">#so it should be &apos;openstack  group create aaa_group&apos;</span><br><span class="line">#openstack group create aaa_group --domain aaa_domain</span><br><span class="line">#openstack group create aaa_group        #we use the default openstack instead</span><br><span class="line">openstack group list --domain aaa_domain</span><br><span class="line">openstack role list</span><br><span class="line">openstack user list --domain aaa_domain</span><br><span class="line">openstack user list --group openstack --domain aaa_domain</span><br><span class="line"></span><br><span class="line">#Assign Role to a user in a Domain, it used --domain</span><br><span class="line">#openstack role add --user johndoe --domain aaa_domain Member</span><br><span class="line">#Assign Role to a group in a project, it used --group-domain</span><br><span class="line">openstack role add --group openstack --group-domain aaa_domain --project myproject Member</span><br><span class="line">openstack role add --group openstack --group-domain aaa_domain --project myproject Admin</span><br><span class="line">openstack role list --group openstack --group-domain aaa_domain --project myproject</span><br><span class="line"></span><br><span class="line">$ openstack user list --domain aaa_domain</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line">| ID                                                               | Name    |</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line">| 5d15ad6474b1f212d159d974eba4d6b402636e67a7253bf7acb64403ff8c2c53 | janedoe |</span><br><span class="line">| dcb455d78a9cc380d615fa79c56569b3e9947d9af7a2f83813b53fca198b61a5 | johndoe |</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line"></span><br><span class="line">$ openstack group contains user --group-domain aaa_domain --user-domain aaa_domain openstack johndoe</span><br><span class="line">johndoe in group openstack</span><br><span class="line"></span><br><span class="line">source ~/stsstack-bundles/novarcv3_project</span><br><span class="line">export OS_USER_DOMAIN_NAME=aaa_domain</span><br><span class="line">export OS_PROJECT_DOMAIN_NAME=aaa_domain</span><br><span class="line">export OS_PROJECT_NAME=myproject</span><br><span class="line">export OS_USERNAME=johndoe</span><br><span class="line">export OS_PASSWORD=crapper</span><br><span class="line">export OS_AUTH_URL=http://10.5.0.72:5000/v3</span><br><span class="line">export OS_AUTH_VERSION=3</span><br><span class="line">export OS_IDENTITY_API_VERSION=3</span><br><span class="line">export OS_REGION_NAME=RegionOne</span><br><span class="line"></span><br><span class="line">ubuntu@zhhuabj-bastion:~⟫ openstack user show johndoe</span><br><span class="line">+---------------------+------------------------------------------------------------------+</span><br><span class="line">| Field               | Value                                                            |</span><br><span class="line">+---------------------+------------------------------------------------------------------+</span><br><span class="line">| domain_id           | ae678292805a4db7917137c0621fe4cc                                 |</span><br><span class="line">| id                  | dcb455d78a9cc380d615fa79c56569b3e9947d9af7a2f83813b53fca198b61a5 |</span><br><span class="line">| name                | johndoe                                                          |</span><br><span class="line">| options             | &#123;&#125;                                                               |</span><br><span class="line">| password_expires_at | None                                                             |</span><br><span class="line">+---------------------+------------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">ubuntu@zhhuabj-bastion:~⟫ openstack user list</span><br><span class="line">You are not authorized to perform the requested action: identity:list_users. (HTTP 403) (Request-ID: req-8c373161-37d7-4d33-9dda-16bdbd2cecb7)</span><br><span class="line"></span><br><span class="line">Why we are not authorized to run &apos;openstack user list&apos;, that&apos;s because the following policy rules.</span><br><span class="line"></span><br><span class="line">&quot;admin_required&quot;: &quot;role:Admin&quot;,</span><br><span class="line">&quot;cloud_admin&quot;: &quot;rule:admin_required and (is_admin_project:True or domain_id:59d6b9c88f654dba9d06772ec1b197f0 or project_id:bbbb856f30b042a9a64d6646273a9ae2)&quot;,</span><br><span class="line">&quot;owner&quot; : &quot;user_id:%(user_id)s or user_id:%(target.token.user_id)s&quot;,</span><br><span class="line">&quot;admin_and_matching_group_domain_id&quot;: &quot;rule:admin_required and domain_id:%(group.domain_id)s&quot;,</span><br><span class="line">&quot;admin_and_matching_domain_id&quot;: &quot;rule:admin_required and domain_id:%(domain_id)s&quot;,</span><br><span class="line"></span><br><span class="line">&quot;identity:get_user&quot;: &quot;rule:cloud_admin or rule:admin_and_matching_target_user_domain_id or rule:owner&quot;,</span><br><span class="line">&quot;identity:list_users&quot;: &quot;rule:cloud_admin or rule:admin_and_matching_domain_id&quot;,</span><br></pre></td></tr></table></figure>
<h2 id="问题一，找不着用户的调试"><a href="#问题一，找不着用户的调试" class="headerlink" title="问题一，找不着用户的调试"></a>问题一，找不着用户的调试</h2><p>找不着用户时, 可查看日志：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(keystone.common.ldap.core): 2018-06-08 12:13:23,145 DEBUG LDAP bind: who=cn=admin,dc=cloud,dc=sts</span><br><span class="line">(keystone.common.ldap.core): 2018-06-08 12:13:23,145 DEBUG LDAP search: base=dc=cloud,dc=sts scope=2 filterstr=(&amp;(uidNumber=10002)(objectClass=inetOrgPerson)) attrs=[&apos;description&apos;, &apos;uidNumber&apos;, &apos;userPassword&apos;, &apos;enabled&apos;, &apos;mail&apos;, &apos;uid&apos;] attrsonly=0</span><br></pre></td></tr></table></figure></p>
<p>转换成下列命令看是否能运行:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ldapsearch -h 10.5.0.53 -x -b &apos;dc=cloud,dc=sts&apos; -s sub &quot;(&amp;(uidNumber=10002)(objectClass=inetOrgPerson))&quot; description uidNumber userPassword enabled mail uid attrsonly=0</span><br></pre></td></tr></table></figure></p>
<h2 id="问题二，group-members-are-ids-True"><a href="#问题二，group-members-are-ids-True" class="headerlink" title="问题二，group_members_are_ids = True"></a>问题二，group_members_are_ids = True</h2><p>例如本例数据：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># Entry 5: cn=openstack,ou=groups,dc=test,dc=com</span><br><span class="line">dn: cn=openstack,ou=groups,dc=test,dc=com</span><br><span class="line">cn: openstack</span><br><span class="line">gidnumber: 501</span><br><span class="line">memberuid: johndoe</span><br><span class="line">objectclass: posixGroup</span><br><span class="line">objectclass: top</span><br><span class="line"></span><br><span class="line"># Entry 8: cn=johndoe,ou=users,dc=test,dc=com</span><br><span class="line">dn: cn=johndoe,ou=users,dc=test,dc=com</span><br><span class="line">cn: johndoe</span><br><span class="line">gidnumber: 501</span><br><span class="line">givenname: John</span><br><span class="line">homedirectory: /home/users/jdoe</span><br><span class="line">loginshell: /bin/sh</span><br><span class="line">objectclass: inetOrgPerson</span><br><span class="line">objectclass: posixAccount</span><br><span class="line">objectclass: top</span><br><span class="line">sn: John Doe</span><br><span class="line">uid: johndoe</span><br><span class="line">uidnumber: 1000</span><br><span class="line">userpassword: &#123;MD5&#125;HOMR4pM15t3gYd8WUxMG8g==</span><br><span class="line"># password is crapper</span><br></pre></td></tr></table></figure></p>
<p>根据这个bug描述 - <a href="https://bugs.launchpad.net/keystone/+bug/1526462" target="_blank" rel="external">https://bugs.launchpad.net/keystone/+bug/1526462</a><br>我们得知在posixGroup类型的group下可以有很多memberuid属性，如本例中为id的形式：<br>memberuid: johndoe<br>也可能为下列dn的形式：<br>memberuid: johndoe,ou=users,dc=test,dc=com<br>在使用rpdb (import rpdb;rpdb.set_trace())对代码调试(nc 127.0.0.1 4444)时会发现， 当group_members_are_ids=true时，list_group_users就不会再根据dn找id了。<br>同时下面的一个if语句(if group_member_id == user_id)决定配置中得是：user_id_attribute = uid<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(Pdb) p group_member_id</span><br><span class="line">u&apos;johndoe&apos;</span><br><span class="line">(Pdb) p user_id</span><br><span class="line">u&apos;johndoe&apos;</span><br><span class="line">(Pdb) l</span><br><span class="line">142             # work.</span><br><span class="line">143             self.get_user(user_id)</span><br><span class="line">144             import rpdb;rpdb.set_trace()</span><br><span class="line">145             member_list = self.group.list_group_users(group_id)</span><br><span class="line">146             for group_member_id in self._transform_group_member_ids(member_list):</span><br><span class="line">147  -&gt;             if group_member_id == user_id:</span><br><span class="line">148                     break</span><br><span class="line">149             else:</span><br><span class="line">150                 raise exception.NotFound(_(&quot;User &apos;%(user_id)s&apos; not found in&quot;</span><br><span class="line">151                                            &quot; group &apos;%(group_id)s&apos;&quot;) %</span><br><span class="line">152                                          &#123;&apos;user_id&apos;: user_id,</span><br></pre></td></tr></table></figure></p>
<h2 id="问题三，怎么用LDAP里的用户"><a href="#问题三，怎么用LDAP里的用户" class="headerlink" title="问题三，怎么用LDAP里的用户"></a>问题三，怎么用LDAP里的用户</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line">1, Confirm the user johndoe is in the domain aaa_domain</span><br><span class="line"></span><br><span class="line">ubuntu@zhhuabj-bastion:~⟫ openstack user list --domain aaa_domain</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line">| ID                                                               | Name    |</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line">| 5d15ad6474b1f212d159d974eba4d6b402636e67a7253bf7acb64403ff8c2c53 | janedoe |</span><br><span class="line">| dcb455d78a9cc380d615fa79c56569b3e9947d9af7a2f83813b53fca198b61a5 | johndoe |</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line"></span><br><span class="line">2, Create a project myproject</span><br><span class="line"></span><br><span class="line">openstack project create myproject --domain aaa_domain</span><br><span class="line"></span><br><span class="line">ubuntu@zhhuabj-bastion:~⟫ openstack project list --domain aaa_domain</span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line">| ID                               | Name      |</span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line">| f239a9aebc974664b3fb7823d7d873fa | myproject |</span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line"></span><br><span class="line">3, LDAP has two groups, one is admin, one is openstack, see https://api.jujucharms.com/charmstore/v5/~openstack-charmers/ldap-test-fixture-3/archive/files/backup.ldif</span><br><span class="line"></span><br><span class="line">ubuntu@zhhuabj-bastion:~⟫ openstack group list --domain aaa_domain</span><br><span class="line">+------------------------------------------------------------------+-----------+</span><br><span class="line">| ID                                                               | Name      |</span><br><span class="line">+------------------------------------------------------------------+-----------+</span><br><span class="line">| a202723c28709cef142842b452fc93caf45d6b661e5d636a96cd10b9379fe0d2 | admin     |</span><br><span class="line">| c94536ce5d46380996999782dacf490b640385cd9b75450782cb279501238eac | openstack |</span><br><span class="line">+------------------------------------------------------------------+-----------+</span><br><span class="line"></span><br><span class="line">ubuntu@zhhuabj-bastion:~⟫ openstack user list --group openstack --domain aaa_domain</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line">| ID                                                               | Name    |</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line">| dcb455d78a9cc380d615fa79c56569b3e9947d9af7a2f83813b53fca198b61a5 | johndoe |</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line">ubuntu@zhhuabj-bastion:~⟫ openstack user list --group admin --domain aaa_domain</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line">| ID                                                               | Name    |</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line">| dcb455d78a9cc380d615fa79c56569b3e9947d9af7a2f83813b53fca198b61a5 | johndoe |</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line"></span><br><span class="line">3, Assign Role to a group in a project</span><br><span class="line"></span><br><span class="line">openstack role add --group openstack --project myproject --group-domain aaa_domain Member</span><br><span class="line">openstack role add --group openstack --project myproject --group-domain aaa_domain Admin</span><br><span class="line"></span><br><span class="line">ubuntu@zhhuabj-bastion:~⟫ openstack role list --group openstack --project myproject --group-domain aaa_domain</span><br><span class="line">Listing assignments using role list is deprecated. Use role assignment list --group &lt;group-name&gt; --project &lt;project-name&gt; --names instead.</span><br><span class="line">+----------------------------------+--------+-----------+-----------+</span><br><span class="line">| ID                               | Name   | Project   | Group     |</span><br><span class="line">+----------------------------------+--------+-----------+-----------+</span><br><span class="line">| 578a7eca0d184945b57ed0b718e59ae0 | Member | myproject | openstack |</span><br><span class="line">| 64c64c90886d4f3cb13d3c599748086b | Admin  | myproject | openstack |</span><br><span class="line">+----------------------------------+--------+-----------+-----------+</span><br><span class="line"></span><br><span class="line">4, Confirm the user johndoe in the the domain aaa_domain and group openstack</span><br><span class="line"></span><br><span class="line">ubuntu@zhhuabj-bastion:~⟫ openstack user list --group openstack --domain aaa_domain</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line">| ID                                                               | Name    |</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line">| dcb455d78a9cc380d615fa79c56569b3e9947d9af7a2f83813b53fca198b61a5 | johndoe |</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line"></span><br><span class="line">5, Switch to use the user johndoe</span><br><span class="line"></span><br><span class="line">source ~/stsstack-bundles/novarcv3_project</span><br><span class="line">export OS_USER_DOMAIN_NAME=aaa_domain</span><br><span class="line">export OS_PROJECT_DOMAIN_NAME=aaa_domain</span><br><span class="line">export OS_PROJECT_NAME=myproject</span><br><span class="line">export OS_USERNAME=johndoe</span><br><span class="line">export OS_PASSWORD=crapper</span><br><span class="line">export OS_AUTH_URL=http://10.5.0.72:5000/v3</span><br><span class="line">export OS_AUTH_VERSION=3</span><br><span class="line">export OS_IDENTITY_API_VERSION=3</span><br><span class="line">export OS_REGION_NAME=RegionOne</span><br><span class="line"></span><br><span class="line">6, Test the user johndoe</span><br><span class="line"></span><br><span class="line">ubuntu@zhhuabj-bastion:~⟫ openstack user show johndoe</span><br><span class="line">+---------------------+------------------------------------------------------------------+</span><br><span class="line">| Field               | Value                                                            |</span><br><span class="line">+---------------------+------------------------------------------------------------------+</span><br><span class="line">| domain_id           | ae678292805a4db7917137c0621fe4cc                                 |</span><br><span class="line">| id                  | dcb455d78a9cc380d615fa79c56569b3e9947d9af7a2f83813b53fca198b61a5 |</span><br><span class="line">| name                | johndoe                                                          |</span><br><span class="line">| options             | &#123;&#125;                                                               |</span><br><span class="line">| password_expires_at | None                                                             |</span><br><span class="line">+---------------------+------------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">ubuntu@zhhuabj-bastion:~⟫ openstack user list</span><br><span class="line">You are not authorized to perform the requested action: identity:list_users. (HTTP 403) (Request-ID: req-8c373161-37d7-4d33-9dda-16bdbd2cecb7)</span><br><span class="line"></span><br><span class="line">Why we are not authorized to run &apos;openstack user list&apos;, that&apos;s because the following policy rules.</span><br><span class="line"></span><br><span class="line">&quot;admin_required&quot;: &quot;role:Admin&quot;,</span><br><span class="line">&quot;cloud_admin&quot;: &quot;rule:admin_required and (is_admin_project:True or domain_id:59d6b9c88f654dba9d06772ec1b197f0 or project_id:bbbb856f30b042a9a64d6646273a9ae2)&quot;,</span><br><span class="line">&quot;owner&quot; : &quot;user_id:%(user_id)s or user_id:%(target.token.user_id)s&quot;,</span><br><span class="line">&quot;admin_and_matching_group_domain_id&quot;: &quot;rule:admin_required and domain_id:%(group.domain_id)s&quot;,</span><br><span class="line">&quot;admin_and_matching_domain_id&quot;: &quot;rule:admin_required and domain_id:%(domain_id)s&quot;,</span><br><span class="line"></span><br><span class="line">&quot;identity:get_user&quot;: &quot;rule:cloud_admin or rule:admin_and_matching_target_user_domain_id or rule:owner&quot;,</span><br><span class="line">&quot;identity:list_users&quot;: &quot;rule:cloud_admin or rule:admin_and_matching_domain_id&quot;,</span><br><span class="line"></span><br><span class="line">怎么才能让openstack user list生效呢？</span><br><span class="line">1, LDAP中的两个组openstack与admin, johndoe都在这两个组下。</span><br><span class="line">ubuntu@zhhuabj-bastion:~⟫ openstack user list --group openstack --domain aaa_domain</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line">| ID                                                               | Name    |</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line">| dcb455d78a9cc380d615fa79c56569b3e9947d9af7a2f83813b53fca198b61a5 | johndoe |</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line">ubuntu@zhhuabj-bastion:~⟫ openstack user list --group admin --domain aaa_domain</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line">| ID                                                               | Name    |</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line">| dcb455d78a9cc380d615fa79c56569b3e9947d9af7a2f83813b53fca198b61a5 | johndoe |</span><br><span class="line">+------------------------------------------------------------------+---------+</span><br><span class="line">2, policy rules中在用project_id:bbbb856f30b042a9a64d6646273a9ae2</span><br><span class="line">所以首先得用admin权限为bbbb856f30b042a9a64d6646273a9ae2这个project添加Admin role：</span><br><span class="line">openstack role add --group admin --project bbbb856f30b042a9a64d6646273a9ae2 --group-domain aaa_domain Admin</span><br><span class="line">其将环境变量得使用这个group：</span><br><span class="line">unset OS_PROJECT_NAME</span><br><span class="line">export OS_PROJECT_ID=bbbb856f30b042a9a64d6646273a9ae2</span><br><span class="line">ubuntu@zhhuabj-bastion:~⟫ openstack user list</span><br><span class="line">+----------------------------------+-------------------+</span><br><span class="line">| ID                               | Name              |</span><br><span class="line">+----------------------------------+-------------------+</span><br><span class="line">| 12507a988b8a438e85ee36617302fd34 | neutron           |</span><br><span class="line">| 1b8ad6f6fc4c479a90b7a34c8187cd3b | cinderv2_cinderv3 |</span><br><span class="line">| 2c6d8f3b156c45b5bb7998cca056edc4 | nova_placement    |</span><br><span class="line">| feaaf07467f142a5a5901ab066af9dca | glance            |</span><br><span class="line">+----------------------------------+-------------------+</span><br><span class="line">ubuntu@zhhuabj-bastion:~⟫ env |grep OS_</span><br><span class="line">OS_PROJECT_ID=bbbb856f30b042a9a64d6646273a9ae2</span><br><span class="line">OS_REGION_NAME=RegionOne</span><br><span class="line">OS_USER_DOMAIN_NAME=aaa_domain</span><br><span class="line">OS_AUTH_VERSION=3</span><br><span class="line">OS_IDENTITY_API_VERSION=3</span><br><span class="line">OS_PASSWORD=crapper</span><br><span class="line">OS_AUTH_URL=http://10.5.0.72:5000/v3</span><br><span class="line">OS_USERNAME=johndoe</span><br><span class="line">OS_PROJECT_DOMAIN_NAME=aaa_domain</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/03/15/回顾OpenStack中的测试/" rel="next" title="回顾OpenStack中的测试">
                <i class="fa fa-chevron-left"></i> 回顾OpenStack中的测试
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/06/13/Play-with-ceph-radosgw/" rel="prev" title="Play with ceph-radosgw">
                Play with ceph-radosgw <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Inhaltsverzeichnis
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Übersicht
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">张华</p>
              <p class="site-description motion-element" itemprop="description">blog.csdn.net/quqi99</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">68</span>
                  <span class="site-state-item-name">Artikel</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Install-OpenLDAP"><span class="nav-number">1.</span> <span class="nav-text">Install OpenLDAP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Modify-default-schema-to-support-OpenStack"><span class="nav-number">2.</span> <span class="nav-text">Modify default schema to support OpenStack</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Configure-Keystone"><span class="nav-number">3.</span> <span class="nav-text">Configure Keystone</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Test"><span class="nav-number">4.</span> <span class="nav-text">Test</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#问题一，找不着用户的调试"><span class="nav-number">5.</span> <span class="nav-text">问题一，找不着用户的调试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#问题二，group-members-are-ids-True"><span class="nav-number">6.</span> <span class="nav-text">问题二，group_members_are_ids = True</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#问题三，怎么用LDAP里的用户"><span class="nav-number">7.</span> <span class="nav-text">问题三，怎么用LDAP里的用户</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">张华</span>

  
</div>


  <div class="powered-by">Erstellt mit  <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
